name: Push Docker Image

on:
  push:
    branches:
      - feat#38 # 또는 배포하려는 브랜치
    paths:
      - 'Backend/backend_model/**'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      -
        name: Checkout
        uses: actions/checkout@v2
      # -
      #   name: Docker meta
      #   id: docker_meta
      #   uses: crazy-max/ghaction-docker-meta@v1
      #   with:
      #     images: heewoni/model_web
      #     tag-semver: |
      #       {{version}}
      #       {{major}}.{{minor}}
      -
        name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v1
      -
        name: Login to DockerHub
        uses: docker/login-action@v1
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}
      -
        name: Build and Push Docker Image
        env:
          DOCKER_REGISTRY: heewoni # Docker Hub 사용시
          IMAGE_NAME: model_web # 이미지 이름
          IMAGE_TAG: latest # 이미지 태그
          DOCKERFILE_PATH: ./Backend/backend_model # 빌드를 원하는 폴더 경로
        run: |
          docker buildx create --use
          docker buildx build -t $DOCKER_REGISTRY/$IMAGE_NAME:$IMAGE_TAG $DOCKERFILE_PATH --push